<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Journey Through Scent — Branching Sequential (v5)</title>
  <style>
    :root{--bg:#000;--ink:#f4f4f4;--dim:#a6a6a6;--line:#1a1a1a;--hi:#fafafa}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);} 
    body{font-family:"Courier New", Courier, ui-monospace, Menlo, Consolas, monospace; letter-spacing:.02em}
    a{color:var(--ink);text-decoration:none}
    a:hover{color:#d1ffd6}
    .scene{display:none;position:relative}
    .scene.active{display:block;animation:fade .35s ease}
    @keyframes fade{from{opacity:.2; transform:translateY(6px)} to{opacity:1; transform:translateY(0)}}
    .wrap{max-width:54rem;margin:0 auto;padding:2rem 1.25rem}
    header{display:flex;justify-content:space-between;align-items:center;margin-bottom:.75rem}
    .stamp{font-size:.75rem;color:var(--dim);letter-spacing:.1em}
    h1{font-size:clamp(1.2rem,2.2vw,1.6rem);margin:.25rem 0 .5rem 0}
    .muted{color:var(--dim)}
    .note{border-top:1px solid var(--line);padding-top:.5rem;margin-top:.5rem}
    nav.links{display:grid;grid-template-columns:1fr;gap:.5rem;margin-top:1rem}
    nav.links a{border:1px solid var(--line);border-radius:10px;padding:.85rem 1rem;background:#0b0b0b}
    nav.links a:hover{outline:1px solid #2a2a2a;box-shadow:0 0 0 1px #2a2a2a inset}
    footer{margin-top:1.25rem;font-size:.85rem;color:var(--dim)}
    .visual{position:absolute;inset:0;pointer-events:none;mix-blend-mode:screen;opacity:.12}
    .grain{position:absolute;inset:-50%;background:radial-gradient(circle at 30% 30%, #fff2, transparent 40%), radial-gradient(circle at 70% 60%, #fff1, transparent 45%), radial-gradient(circle at 10% 80%, #fff2, transparent 35%); filter:contrast(140%) saturate(0.6);animation:grain 8s linear infinite}
    @keyframes grain{0%{transform:translate(0,0)}25%{transform:translate(-2%,1%)}50%{transform:translate(1%,-1%)}75%{transform:translate(2%,2%)}100%{transform:translate(0,0)}}
    .scan{position:absolute;left:0;right:0;top:-40%;height:40%;background:linear-gradient(180deg,rgba(255,255,255,.08),transparent);animation:scan 9s linear infinite}
    @keyframes scan{to{top:130%}}
    .cursor:after{content:"_";animation:blink 1.2s step-start infinite}
    @keyframes blink{50%{opacity:0}}
    .chips{display:flex;gap:.4rem;flex-wrap:wrap;margin-top:.5rem}
    .chip{border:1px solid var(--line);border-radius:6px;padding:.25rem .5rem;font-size:.8rem;color:#cfcfcf}
    .split{display:grid;grid-template-columns:1.2fr .8fr;gap:1rem}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:.75rem}
    .thumb{border:1px solid var(--line);border-radius:10px;min-height:120px;background:#0b0b0b}
    figure.art{border:1px solid var(--line);border-radius:12px;min-height:42vh;background:#0b0b0b}
    @media(max-width:900px){.split{grid-template-columns:1fr}.grid2{grid-template-columns:1fr}}
  .type-caret:after{content:"▍";display:inline-block;margin-left:2px;animation:blink 1s steps(1,end) infinite}@keyframes blink{50%{opacity:0}}
.tw{white-space:pre-wrap}
.tw.done:after{content:""}
</style>
</head>
<body>

  <section class="scene active" id="start">
    <div class="visual"><div class="grain"></div><div class="scan"></div></div>
    <div class="wrap split">
      <div>
        <header>
          <div class="cursor">Journey Through Scent</div>
          <div class="stamp">sequential / branching / v5</div>
        </header>
        <h1 class="tw" data-text="Translate your personality into fragrance."></h1>
        <p class="muted">Follow the hyperlinks. One question per page. Your answer chooses the next question.</p>
        <nav class="links"><a data-next="q1">Start</a></nav>
        <footer>All navigation is hyperlink-based. No forms. No buttons.</footer>
      </div>
      <figure class="art" id="art-start"></figure>
    </div>
  </section>

  <section class="scene" id="q1">
    <div class="visual"><div class="grain"></div><div class="scan"></div></div>
    <div class="wrap split">
      <div>
        <header><div class="cursor">Q1</div><div class="stamp">purpose: intensity & projection</div></header>
        <h1 class="tw" data-text="What rhythm best describes your day?"></h1>
        <nav class="links">
          <a data-next="q2_light" data-param="i=light">Soft and gentle</a>
          <a data-next="q2_balanced" data-param="i=balanced">Organized and steady</a>
          <a data-next="q2_deep" data-param="i=deep">Focused at night</a>
          <a data-next="q2_energetic" data-param="i=energetic">Spontaneous and lively</a>
        </nav>
        <footer><a data-next="start">Restart</a></footer>
      </div>
      <figure class="art" id="art-q1"></figure>
    </div>
  </section>

  <section class="scene" id="q2_light">
    <div class="visual"><div class="grain"></div><div class="scan"></div></div>
    <div class="wrap split">
      <div>
        <header><div class="cursor">Q2</div><div class="stamp">tone & atmosphere</div></header>
        <h1 class="tw" data-text="Which air feels most like you?"></h1>
        <nav class="links">
          <a data-next="q3_clean_citrus" data-param="air=dawn">Cool morning air</a>
          <a data-next="q3_floral_soft" data-param="air=noon">Heavy afternoon light</a>
          <a data-next="q3_green_breeze" data-param="air=rain">Air after rain</a>
          <a data-next="q3_night_sheen" data-param="air=night">Calm midnight air</a>
        </nav>
        <footer><a data-next="start">Restart</a></footer>
      </div>
      <figure class="art" id="art-q2_light"></figure>
    </div>
  </section>

  <section class="scene" id="q2_balanced">
    <div class="visual"><div class="grain"></div><div class="scan"></div></div>
    <div class="wrap split">
      <div>
        <header><div class="cursor">Q2</div><div class="stamp">tone & atmosphere</div></header>
        <h1 class="tw" data-text="Afternoon light, choose a direction."></h1>
        <nav class="links">
          <a data-next="q3_clean_citrus" data-param="air=noon">Citrus clarity</a>
          <a data-next="q3_floral_soft" data-param="air=noon">Soft floral</a>
          <a data-next="q3_green_breeze" data-param="air=rain">Green after rain</a>
          <a data-next="q3_night_sheen" data-param="air=night">Musky hush</a>
        </nav>
        <footer><a data-next="start">Restart</a></footer>
      </div>
      <figure class="art" id="art-q2_balanced"></figure>
    </div>
  </section>

  <section class="scene" id="q2_deep">
    <div class="visual"><div class="grain"></div><div class="scan"></div></div>
    <div class="wrap split">
      <div>
        <header><div class="cursor">Q2</div><div class="stamp">tone & atmosphere</div></header>
        <h1 class="tw" data-text="Midnight calm. Where do you go?"></h1>
        <nav class="links">
          <a data-next="q3_spice_resin" data-param="air=night">Spice & resin</a>
          <a data-next="q3_amber_musk" data-param="air=night">Amber & musk</a>
          <a data-next="q3_green_breeze" data-param="air=rain">After-rain green</a>
          <a data-next="q3_night_sheen" data-param="air=night">Skin-sheen musk</a>
        </nav>
        <footer><a data-next="start">Restart</a></footer>
      </div>
      <figure class="art" id="art-q2_deep"></figure>
    </div>
  </section>

  <section class="scene" id="q2_energetic">
    <div class="visual"><div class="grain"></div><div class="scan"></div></div>
    <div class="wrap split">
      <div>
        <header><div class="cursor">Q2</div><div class="stamp">tone & atmosphere</div></header>
        <h1 class="tw" data-text="Rain runner or sun chaser?"></h1>
        <nav class="links">
          <a data-next="q3_green_breeze" data-param="air=rain">Green & brisk</a>
          <a data-next="q3_clean_citrus" data-param="air=dawn">Sparkling citrus</a>
          <a data-next="q3_floral_soft" data-param="air=noon">Bright floral</a>
          <a data-next="q3_night_sheen" data-param="air=night">Electric musk</a>
        </nav>
        <footer><a data-next="start">Restart</a></footer>
      </div>
      <figure class="art" id="art-q2_energetic"></figure>
    </div>
  </section>

  <section class="scene" id="q3_clean_citrus">
    <div class="visual"><div class="grain"></div><div class="scan"></div></div>
    <div class="wrap split">
      <div>
        <header><div class="cursor">Q3</div><div class="stamp">note nuance</div></header>
        <h1 class="tw" data-text="You chose clarity. Which citrus?"></h1>
        <nav class="links">
          <a data-next="q4_city" data-param="mood=clean&note=bergamot">Bergamot</a>
          <a data-next="q4_city" data-param="mood=clean&note=grapefruit">Grapefruit</a>
          <a data-next="q4_city" data-param="mood=clean&note=neroli">Neroli</a>
          <a data-next="q4_city" data-param="mood=clean&note=lemon">Lemon</a>
        </nav>
        <div class="chips"><div class="chip">fresh</div><div class="chip">airy</div><div class="chip">daylight</div></div>
      </div>
      <figure class="art" id="art-q3_clean_citrus"></figure>
    </div>
  </section>

  <section class="scene" id="q3_floral_soft">
    <div class="visual"><div class="grain"></div><div class="scan"></div></div>
    <div class="wrap split">
      <div>
        <header><div class="cursor">Q3</div><div class="stamp">note nuance</div></header>
        <h1 class="tw" data-text="Soft bloom. Which flower?"></h1>
        <nav class="links">
          <a data-next="q4_city" data-param="mood=warm&note=rose">Rose</a>
          <a data-next="q4_city" data-param="mood=warm&note=jasmine">Jasmine</a>
          <a data-next="q4_city" data-param="mood=warm&note=peony">Peony</a>
          <a data-next="q4_city" data-param="mood=warm&note=iris">Iris</a>
        </nav>
        <div class="chips"><div class="chip">petal</div><div class="chip">musk</div><div class="chip">soft light</div></div>
      </div>
      <figure class="art" id="art-q3_floral_soft"></figure>
    </div>
  </section>

  <section class="scene" id="q3_green_breeze">
    <div class="visual"><div class="grain"></div><div class="scan"></div></div>
    <div class="wrap split">
      <div>
        <header><div class="cursor">Q3</div><div class="stamp">note nuance</div></header>
        <h1 class="tw" data-text="After-rain green. Which path?"></h1>
        <nav class="links">
          <a data-next="q4_city" data-param="mood=myst&note=fig">Fig leaf</a>
          <a data-next="q4_city" data-param="mood=myst&note=vétiver">Vetiver</a>
          <a data-next="q4_city" data-param="mood=myst&note=herbs">Herbal</a>
          <a data-next="q4_city" data-param="mood=myst&note=tea">Tea</a>
        </nav>
        <div class="chips"><div class="chip">transparent woods</div><div class="chip">green</div></div>
      </div>
      <figure class="art" id="art-q3_green_breeze"></figure>
    </div>
  </section>

  <section class="scene" id="q3_night_sheen">
    <div class="visual"><div class="grain"></div><div class="scan"></div></div>
    <div class="wrap split">
      <div>
        <header><div class="cursor">Q3</div><div class="stamp">note nuance</div></header>
        <h1 class="tw" data-text="Midnight sheen. What kind of allure?"></h1>
        <nav class="links">
          <a data-next="q4_city" data-param="mood=sensual&note=amber">Amber glow</a>
          <a data-next="q4_city" data-param="mood=sensual&note=leather">Leather ribbon</a>
          <a data-next="q4_city" data-param="mood=sensual&note=incense">Incense veil</a>
          <a data-next="q4_city" data-param="mood=sensual&note=spice">Saffron & spice</a>
        </nav>
        <div class="chips"><div class="chip">nocturne</div><div class="chip">silhouette</div></div>
      </div>
      <figure class="art" id="art-q3_night_sheen"></figure>
    </div>
  </section>

  <section class="scene" id="q4_city">
    <div class="visual"><div class="grain"></div><div class="scan"></div></div>
    <div class="wrap split">
      <div>
        <header><div class="cursor">Q4</div><div class="stamp">brand / style association</div></header>
        <h1 class="tw" data-text="Which city would you like to wander in now?"></h1>
        <nav class="links">
          <a data-next="q5_mat" data-param="city=paris">Paris</a>
          <a data-next="q5_mat" data-param="city=ny">New York</a>
          <a data-next="q5_mat" data-param="city=tokyo">Tokyo</a>
          <a data-next="q5_mat" data-param="city=maldives">Maldives</a>
        </nav>
        <footer><a data-next="start">Restart</a></footer>
      </div>
      <figure class="art" id="art-q4_city"></figure>
    </div>
  </section>

  <section class="scene" id="q5_mat">
    <div class="visual"><div class="grain"></div><div class="scan"></div></div>
    <div class="wrap split">
      <div>
        <header><div class="cursor">Q5</div><div class="stamp">texture & longevity</div></header>
        <h1 class="tw" data-text="If you were a perfume bottle, what material would you be?"></h1>
        <nav class="links">
          <a data-next="q6_echo" data-param="mat=glass">Transparent glass</a>
          <a data-next="q6_echo" data-param="mat=metal">Metal</a>
          <a data-next="q6_echo" data-param="mat=velvet">Velvet</a>
          <a data-next="q6_echo" data-param="mat=stone">Stone</a>
        </nav>
        <footer><a data-next="start">Restart</a></footer>
      </div>
      <figure class="art" id="art-q5_mat"></figure>
    </div>
  </section>

  <section class="scene" id="q6_echo">
    <div class="visual"><div class="grain"></div><div class="scan"></div></div>
    <div class="wrap split">
      <div>
        <header><div class="cursor">Q6</div><div class="stamp">afterglow identity</div></header>
        <h1 class="tw" data-text="What remains after the scent fades?"></h1>
        <nav class="links">
          <a data-next="result" data-param="echo=memory">Memory</a>
          <a data-next="result" data-param="echo=trail">Trail</a>
          <a data-next="result" data-param="echo=person">Someone</a>
          <a data-next="result" data-param="echo=air">Air</a>
        </nav>
        <footer><a data-next="start">Restart</a></footer>
      </div>
      <figure class="art" id="art-q6_echo"></figure>
    </div>
  </section>

  <section class="scene" id="result">
    <div class="visual"><div class="grain"></div><div class="scan"></div></div>
    <div class="wrap split">
      <div>
        <header>
          <div class="cursor">Your Scent Portrait</div>
          <div class="stamp" id="stamp">—</div>
        </header>
        <div id="summary" class="note">Your choices assemble a profile.</div>
        <h1 id="family" class="tw" data-text=""></h1>
        <div id="picks" class="grid2"></div>
        <p id="tip" class="muted" style="display:none">Tip: Spray on your wrist and check again after 2–4 hours. Citrus/green fade faster; woods/musk last longer.</p>
        <footer><a data-next="start">Start over</a></footer>
      </div>
      <figure class="art" id="art-result"></figure>
    </div>
  </section>

  <script>
    const $$=(s,c=document)=>Array.from(c.querySelectorAll(s));
    const $=(s,c=document)=>c.querySelector(s);

    function svgBlob(label, hue){
      const bg = `hsl(${hue}, 75%, 12%)`;
      const grad1 = `hsl(${(hue+30)%360}, 80%, 55%)`;
      const grad2 = `hsl(${(hue+300)%360}, 70%, 45%)`;
      const txt = `hsl(${hue}, 10%, 92%)`;
      const svg = encodeURIComponent(
        `<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 600 400'>
          <defs>
            <radialGradient id='g' cx='30%' cy='30%'>
              <stop offset='0%' stop-color='${grad1}' stop-opacity='0.9'/>
              <stop offset='60%' stop-color='${grad2}' stop-opacity='0.35'/>
              <stop offset='100%' stop-color='${bg}' stop-opacity='0.2'/>
            </radialGradient>
          </defs>
          <rect width='600' height='400' fill='${bg}'/>
          <circle cx='180' cy='150' r='140' fill='url(#g)' />
          <circle cx='420' cy='260' r='170' fill='url(#g)' />
          <text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' fill='${txt}' font-family='Courier New, monospace' font-size='26'>${label}</text>
        </svg>`
      );
      return `url("data:image/svg+xml,${svg}")`;
    }

    function paintArt(id, label, hue){
      const el = document.getElementById('art-'+id);
      if(!el) return;
      el.style.backgroundImage = svgBlob(label, hue);
      el.style.backgroundSize = 'cover';
      el.style.backgroundPosition = 'center';
      el.style.filter = 'saturate(0.9)';
    }

    function perfumeThumb(name){
      const hue = Math.abs([...name].reduce((a,c)=>a + c.charCodeAt(0), 0)) % 360;
      const label = name.split(' ')[0];
      const bg = svgBlob(label, hue);
      return `<div class="thumb" style="background-image:${bg};background-size:cover;background-position:center"></div>`;
    }

    const RESULTS={
      fresh_citrus_day:{title:"Fresh Citrus / Day",picks:[
        {name:"Acqua di Parma Colonia",notes:"citrus, lavender, rosemary",vibe:"classic, bright, tailored",why:"For airy brightness with a clean finish.",link:"https://www.acquadiparma.com/"},
        {name:"Byredo Blanche",notes:"aldehydes, rose, musk",vibe:"clean, linen-fresh, minimal",why:"Soft, soapy clarity for everyday wear.",link:"https://www.byredo.com/"}
      ]},
      airy_green_woods:{title:"Airy Green Woods",picks:[
        {name:"Diptyque Philosykos (EDT)",notes:"fig leaf, coconut, woody",vibe:"sunlit, leafy, transparent",why:"Green fig with breezy woods.",link:"https://www.diptyqueparis.com/"},
        {name:"Le Labo Another 13",notes:"ambroxan, pear, musk",vibe:"sheer, modern, skin-scent",why:"Subtle radiance with a cool edge.",link:"https://www.lelabofragrances.com/"}
      ]},
      cozy_sweet_gourmand:{title:"Cozy Sweet / Gourmand",picks:[
        {name:"Replica – By the Fireplace",notes:"smoke, chestnut, vanilla",vibe:"cozy, toasted, nostalgic",why:"A smoky-sweet hug for cold evenings.",link:"https://www.maisonmargiela-fragrances.us/"},
        {name:"Prada Candy",notes:"caramel, benzoin, musk",vibe:"playful, plush, sweet",why:"Dessert-like sweetness with warmth.",link:"https://www.prada.com/"}
      ]},
      spicy_resinous_night:{title:"Spicy & Resinous / Night",picks:[
        {name:"Tom Ford Oud Wood",notes:"cardamom, oud, amber",vibe:"smoky, polished, intimate",why:"A sophisticated evening signature.",link:"https://www.tomford.com/"},
        {name:"Byredo Black Saffron",notes:"saffron, leather, raspberry",vibe:"warm, distinct, luminous",why:"Luminous spice with sleek leather.",link:"https://www.byredo.com/"}
      ]},
      floral_musk_soft:{title:"Soft Floral Musk",picks:[
        {name:"Chanel Chance Eau Tendre",notes:"grapefruit, jasmine, musk",vibe:"petal-soft, youthful, bright",why:"A dreamy everyday floral.",link:"https://www.chanel.com/"},
        {name:"Glossier You",notes:"ambrette, musk",vibe:"clean, minimalist, skin-like",why:"Barely-there, you—but better.",link:"https://www.glossier.com/"}
      ]},
      aromatic_fresh_sport:{title:"Aromatic Fresh / Sporty",picks:[
        {name:"Dior Sauvage EDT",notes:"bergamot, pepper, ambroxan",vibe:"crisp, energetic, versatile",why:"Instantly fresh, go-anywhere.",link:"https://www.dior.com/"},
        {name:"Hermès H24",notes:"clary sage, rosewood, metallic moss",vibe:"green, modern, lucid",why:"Sleek green freshness.",link:"https://www.hermes.com/"}
      ]}
    };

    const labelMaps={
      mood:{clean:"clean",warm:"warm",myst:"mysterious",sensual:"sensual"},
      air:{dawn:"morning air",noon:"afternoon light",rain:"after rain",night:"midnight calm"},
      i:{light:"light",balanced:"balanced",deep:"deep",energetic:"energetic"},
      city:{paris:"Paris",ny:"New York",tokyo:"Tokyo",maldives:"Maldives"},
      mat:{glass:"glass",metal:"metal",velvet:"velvet",stone:"stone"},
      echo:{memory:"memory",trail:"trail",person:"someone",air:"air"},
      note:{bergamot:"bergamot",grapefruit:"grapefruit",neroli:"neroli",lemon:"lemon",rose:"rose",jasmine:"jasmine",peony:"peony",iris:"iris",fig:"fig",vétiver:"vetiver",herbs:"herbal",tea:"tea",amber:"amber",leather:"leather",incense:"incense",spice:"spice"}
    };

    function parse(){
      const raw=location.hash.replace(/^#/,"");
      const [id='start',query='']=raw.split('?');
      const params=Object.fromEntries(new URLSearchParams(query));
      return {id,params};
    }

    function href(next, params, add){
      const q=new URLSearchParams(params);
      if(add){ for(const pair of add.split('&')){ const [k,v]=pair.split('='); q.set(k,v); } }
      const qs=q.toString();
      return `#${next}${qs?`?${qs}`:''}`;
    }

    function humanize(p){
      const order=['i','air','mood','note','city','mat','echo'];
      return order.map(k=>labelMaps[k]&&labelMaps[k][p[k]]).filter(Boolean).join(' · ');
    }

    function inferResultKey(p){
      if(p.mood==='clean'){ if(p.air==='dawn'||p.air==='rain'||p.note==='bergamot'||p.note==='neroli') return 'fresh_citrus_day'; return 'aromatic_fresh_sport'; }
      if(p.mood==='warm'){ if(p.note==='rose'||p.note==='jasmine'||p.mat==='velvet'||p.echo==='person') return 'floral_musk_soft'; return 'cozy_sweet_gourmand'; }
      if(p.mood==='sensual'){ if(p.note==='leather'||p.note==='incense'||p.note==='spice') return 'spicy_resinous_night'; return 'floral_musk_soft'; }
      if(p.mood==='myst'){ if(p.note==='fig'||p.note==='vétiver'||p.air==='rain'||p.city==='tokyo') return 'airy_green_woods'; return 'spicy_resinous_night'; }
      if(p.i==='light'&&(p.air==='dawn'||p.air==='rain')) return 'airy_green_woods';
      return 'floral_musk_soft';
    }

    function renderArt(id, params){
      const keys=['note','mood','air','i'];
      let hue=210; let label='Scent';
      for(const k of keys){ if(params[k]){ const seed = Math.abs([...params[k]].reduce((a,c)=>a+c.charCodeAt(0),0)); hue = seed % 360; label = (labelMaps[k]&&labelMaps[k][params[k]])||label; break; } }
      paintArt(id, label, hue);
    }

    function render(){
      const {id,params}=parse();
      $$('.scene').forEach(s=>s.classList.remove('active'));
      (document.getElementById(id)||document.getElementById('start')).classList.add('active');
      $$('a[data-next]').forEach(a=>{ a.setAttribute('href', href(a.dataset.next, params, a.dataset.param||'')); });
      renderArt(id, params);
      if(id==='result'){
        $('#stamp').textContent = humanize(params) || '—';
        $('#summary').textContent = humanize(params) ? `You lean toward: ${humanize(params)}` : 'Your choices assemble a profile.';
        const key=inferResultKey(params); const data=RESULTS[key];
        $('#family').textContent = `Suggested Family — ${data.title}`;
        $('#picks').innerHTML = data.picks.map(p=>`
          <a class="note" style="display:block;color:inherit" href="${p.link}" target="_blank" rel="noreferrer">
            ${perfumeThumb(p.name)}
            <div style="margin-top:.5rem"><strong>${p.name}</strong></div>
            <div class="muted">Notes: ${p.notes}</div>
            <div class="muted">Vibe: ${p.vibe}</div>
            <div>${p.why}</div>
          </a>
        `).join('');
        document.getElementById('art-result') && paintArt('result', data.title, Math.abs(key.split('').reduce((a,c)=>a+c.charCodeAt(0),0))%360);
        document.getElementById('tip').style.display='block';
      }
    }

    window.addEventListener('hashchange', render);
    window.addEventListener('DOMContentLoaded', ()=>{ if(!location.hash) location.hash='#start'; render(); });
  
    // --- typewriter ---
    function typeIn(el, text, speed){
      if(!el) return;
      el.classList.add('type-caret');
      el.classList.remove('done');
      let i = 0;
      (function step(){
        if(i <= text.length){
          el.textContent = text.slice(0,i);
          i++;
          setTimeout(step, speed + Math.random()*22);
        } else {
          el.classList.remove('type-caret');
          el.classList.add('done');
        }
      })();
    }
        else { el.classList.remove('type-caret'); el.classList.add('done'); }
      } step();
    }
    function typeOnce(el, speed){
      if(!el) return;
      const text = el.dataset.text || el.textContent || '';
      el.textContent = '';
      typeIn(el, text, speed);
    }

    function prepareTypeTargets(){
      document.querySelectorAll('.tw').forEach(el=>{
        if(!el.dataset.text){ el.dataset.text = (el.textContent || '').trim(); }
        el.textContent='';
      });
    });
    }

    // augment render to trigger typing on scene activate
    const _render = render;
    const TYPE_SPEED = 55; // slower typing (ms per char base)
    render = function(){
      _render();
      const raw=location.hash.replace(/^#/,"");
      const [id='start']=raw.split('?');
      const scene = document.getElementById(id) || document.getElementById('start');
      // type all .tw elements within the active scene
      scene.querySelectorAll('.tw').forEach(el=> typeOnce(el, TYPE_SPEED));
    }

    window.addEventListener('DOMContentLoaded', ()=>{
      // Fallback hrefs so links work even before first render
      document.querySelectorAll('a[data-next]').forEach(a=>{
        if(!a.getAttribute('href')) a.setAttribute('href', '#'+(a.dataset.next||''));
      });
      prepareTypeTargets();
      if(!location.hash) location.hash='#start';
      try { render(); }
      catch(e){
        console.error('[render fallback]', e);
        // graceful fallback: show static text so questions are visible
        document.querySelectorAll('.tw').forEach(el=>{
          el.textContent = el.dataset.text || el.textContent || '';
        });
      }
    }); });
  </script>
</body>
</body>
</html>
