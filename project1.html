<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Journey Through Scent — Analog Edition (v6)</title>
  <style>
    :root{
      --bg:#000;--ink:#f4f4f4;--dim:#a6a6a6;--line:#1a1a1a;--hi:#fafafa;
      --accent:#d1ffd6;
    }
    html,body{margin:0;padding:0;background:var(--bg);color:var(--ink)}
    body{font-family:"Courier New", Courier, ui-monospace, Menlo, Consolas, monospace; letter-spacing:.02em}
    a{color:var(--ink);text-decoration:none}
    a:hover{color:var(--accent)}

    /* Layout */
    .scene{display:none;position:relative}
    .scene.active{display:block}
    .wrap{max-width:60rem;margin:0 auto;padding:2rem 1.25rem}
    header{display:flex;justify-content:space-between;align-items:center;margin-bottom:.75rem}
    h1{font-size:clamp(1.2rem,2.2vw,1.6rem);margin:.25rem 0 .5rem 0}
    .muted{color:var(--dim)}
    .note{border-top:1px solid var(--line);padding-top:.5rem;margin-top:.5rem}
    .split{display:grid;grid-template-columns:1.2fr .8fr;gap:1rem}
    @media(max-width:900px){.split{grid-template-columns:1fr}}

    /* Links like annotated text */
    nav.links{display:grid;grid-template-columns:1fr;gap:.55rem;margin-top:1rem}
    nav.links a{
      background:linear-gradient(transparent 60%, #d1ffd610 0);
      border:1px solid var(--line);border-radius:8px;padding:.7rem .8rem;background-color:#0b0b0b;
      position:relative; line-height:1.35
    }
    nav.links a::after{content:attr(data-page); position:absolute; right:.6rem; top:.5rem; color:#8a8a8a; font-size:.78rem}
    nav.links a:hover{outline:1px solid #2a2a2a; box-shadow:0 0 0 1px #2a2a2a inset; text-decoration:underline; text-underline-offset:.15rem}

    footer{margin-top:1.25rem;font-size:.85rem;color:var(--dim)}

    /* Visual layer (scan + grain) */
    .visual{position:absolute;inset:0;pointer-events:none;mix-blend-mode:screen;opacity:.12}
    .grain{position:absolute;inset:-50%;background:radial-gradient(circle at 30% 30%, #fff2 0, transparent 40%), radial-gradient(circle at 70% 60%, #fff1 0, transparent 45%), radial-gradient(circle at 10% 80%, #fff2 0, transparent 35%); filter:contrast(140%) saturate(.6); animation:grain 8s linear infinite}
    @keyframes grain{0%{transform:translate(0,0)}25%{transform:translate(-2%,1%)}50%{transform:translate(1%,-1%)}75%{transform:translate(2%,2%)}100%{transform:translate(0,0)}}
    .scan{position:absolute;left:0;right:0;top:-40%;height:40%;background:linear-gradient(180deg,rgba(255,255,255,.08),transparent);animation:scan 9s linear infinite}
    @keyframes scan{to{top:130%}}

    /* Paper / halftone overlay */
    .paper{pointer-events:none;position:fixed;inset:0;z-index:9999;mix-blend-mode:overlay;opacity:.25;
      background:
        url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="6" height="6"><circle cx="1" cy="1" r="1" fill="%23ffffff14"/></svg>') repeat,
        radial-gradient(#ffffff0f 0, transparent 60%);
    }
    /* global halftone-ish wash */
    .wash{position:fixed;inset:0;pointer-events:none;z-index:9998}
    .wash svg{width:0;height:0}
    .halftone{filter:url(#halftone)}

    /* Art panels */
    figure.art{border:1px solid var(--line);border-radius:12px;min-height:42vh;background:#0b0b0b}
    .thumb{border:1px solid var(--line);border-radius:10px;min-height:120px;background:#0b0b0b}

    .chips{display:flex;gap:.4rem;flex-wrap:wrap;margin-top:.5rem}
    .chip{border:1px solid var(--line);border-radius:6px;padding:.25rem .5rem;font-size:.8rem;color:#cfcfcf}

    .stamp{font-size:.75rem;color:var(--dim);letter-spacing:.1em}
    .margin-note{font-family:"Bradley Hand","Comic Sans MS", ui-rounded, cursive; color:#cfcfcf; opacity:.75; font-size:.9rem; transform:rotate(-0.35deg); margin-top:.35rem}

    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:.75rem}
    @media(max-width:900px){.grid2{grid-template-columns:1fr}}

    /* Cut edit flash */
    .cut-in{animation:cut .12s steps(1,end)}
    @keyframes cut{0%{filter:brightness(1.35)}100%{filter:brightness(1)}}

    /* Typewriter */
    .type-caret:after{content:"▍";display:inline-block;margin-left:2px;animation:blink 1s steps(1,end) infinite}
    @keyframes blink{50%{opacity:0}}
    .tw{white-space:pre-wrap}
    .tw.done:after{content:""}
  </style>
</head>
<body class="halftone">

  <!-- overlays -->
  <div class="paper"></div>
  <div class="wash">
    <svg aria-hidden="true">
      <filter id="halftone">
        <feColorMatrix type="saturate" values="0.9"/>
        <feComponentTransfer>
          <feFuncR type="gamma" amplitude="1" exponent="0.9"/>
          <feFuncG type="gamma" amplitude="1" exponent="0.9"/>
          <feFuncB type="gamma" amplitude="1" exponent="0.9"/>
        </feComponentTransfer>
        <feTurbulence baseFrequency="0.8" numOctaves="2" seed="3" type="fractalNoise" result="noise"/>
        <feColorMatrix in="noise" type="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 .10 0"/>
        <feBlend mode="multiply"/>
      </filter>
    </svg>
  </div>

  <!-- Audio (optional, enabled after first click) -->
  <audio id="click-snd" preload="auto">
    <source src="data:audio/wav;base64,UklGRmQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABYAaW5mbwAA" type="audio/wav" />
  </audio>

  <!-- SCENES -->
  <section class="scene active" id="start">
    <div class="visual"><div class="grain"></div><div class="scan"></div></div>
    <div class="wrap split">
      <div>
        <header>
          <div class="cursor">Journey Through Scent</div>
          <div class="stamp" id="time-start">archive · --:--</div>
        </header>
        <h1 class="tw" data-text="Translate your personality into fragrance."></h1>
        <p class="muted">Follow the hyperlinks. One question per page. Your answer chooses the next question.</p>
        <p class="margin-note">※ Read like a catalogued conversation.</p>
        <nav class="links">
          <a data-next="q1" data-page="P.01 →">Start</a>
        </nav>
        <footer>All navigation is hyperlink-based. No forms. No buttons.</footer>
      </div>
      <figure class="art" id="art-start"></figure>
    </div>
  </section>

  <!-- Q1 -->
  <section class="scene" id="q1">
    <div class="visual"><div class="grain"></div><div class="scan"></div></div>
    <div class="wrap split">
      <div>
        <header><div class="cursor">Q1</div><div class="stamp" id="time-q1">archive · --:--</div></header>
        <h1 class="tw" data-text="What rhythm best describes your day?"></h1>
        <nav class="links">
          <a data-next="q2_light" data-param="i=light" data-page="P.02 →">Soft and gentle</a>
          <a data-next="q2_balanced" data-param="i=balanced" data-page="P.02 →">Organized and steady</a>
          <a data-next="q2_deep" data-param="i=deep" data-page="P.02 →">Focused at night</a>
          <a data-next="q2_energetic" data-param="i=energetic" data-page="P.02 →">Spontaneous and lively</a>
        </nav>
        <footer><a data-next="start">Restart</a></footer>
      </div>
      <figure class="art" id="art-q1"></figure>
    </div>
  </section>

  <!-- Q2 variants -->
  <section class="scene" id="q2_light">
    <div class="visual"><div class="grain"></div><div class="scan"></div></div>
    <div class="wrap split">
      <div>
        <header><div class="cursor">Q2</div><div class="stamp" id="time-q2_light">archive · --:--</div></header>
        <h1 class="tw" data-text="Which air feels most like you?"></h1>
        <nav class="links">
          <a data-next="q3_clean_citrus" data-param="air=dawn" data-page="P.03 →">Cool morning air</a>
          <a data-next="q3_floral_soft" data-param="air=noon" data-page="P.03 →">Heavy afternoon light</a>
          <a data-next="q3_green_breeze" data-param="air=rain" data-page="P.03 →">Air after rain</a>
          <a data-next="q3_night_sheen" data-param="air=night" data-page="P.03 →">Calm midnight air</a>
        </nav>
        <footer><a data-next="start">Restart</a></footer>
      </div>
      <figure class="art" id="art-q2_light"></figure>
    </div>
  </section>

  <section class="scene" id="q2_balanced">
    <div class="visual"><div class="grain"></div><div class="scan"></div></div>
    <div class="wrap split">
      <div>
        <header><div class="cursor">Q2</div><div class="stamp" id="time-q2_balanced">archive · --:--</div></header>
        <h1 class="tw" data-text="Afternoon light, choose a direction."></h1>
        <nav class="links">
          <a data-next="q3_clean_citrus" data-param="air=noon" data-page="P.03 →">Citrus clarity</a>
          <a data-next="q3_floral_soft" data-param="air=noon" data-page="P.03 →">Soft floral</a>
          <a data-next="q3_green_breeze" data-param="air=rain" data-page="P.03 →">Green after rain</a>
          <a data-next="q3_night_sheen" data-param="air=night" data-page="P.03 →">Musky hush</a>
        </nav>
        <footer><a data-next="start">Restart</a></footer>
      </div>
      <figure class="art" id="art-q2_balanced"></figure>
    </div>
  </section>

  <section class="scene" id="q2_deep">
    <div class="visual"><div class="grain"></div><div class="scan"></div></div>
    <div class="wrap split">
      <div>
        <header><div class="cursor">Q2</div><div class="stamp" id="time-q2_deep">archive · --:--</div></header>
        <h1 class="tw" data-text="Midnight calm. Where do you go?"></h1>
        <nav class="links">
          <a data-next="q3_spice_resin" data-param="air=night" data-page="P.03 →">Spice & resin</a>
          <a data-next="q3_amber_musk" data-param="air=night" data-page="P.03 →">Amber & musk</a>
          <a data-next="q3_green_breeze" data-param="air=rain" data-page="P.03 →">After-rain green</a>
          <a data-next="q3_night_sheen" data-param="air=night" data-page="P.03 →">Skin-sheen musk</a>
        </nav>
        <footer><a data-next="start">Restart</a></footer>
      </div>
      <figure class="art" id="art-q2_deep"></figure>
    </div>
  </section>

  <section class="scene" id="q2_energetic">
    <div class="visual"><div class="grain"></div><div class="scan"></div></div>
    <div class="wrap split">
      <div>
        <header><div class="cursor">Q2</div><div class="stamp" id="time-q2_energetic">archive · --:--</div></header>
        <h1 class="tw" data-text="Rain runner or sun chaser?"></h1>
        <nav class="links">
          <a data-next="q3_green_breeze" data-param="air=rain" data-page="P.03 →">Green & brisk</a>
          <a data-next="q3_clean_citrus" data-param="air=dawn" data-page="P.03 →">Sparkling citrus</a>
          <a data-next="q3_floral_soft" data-param="air=noon" data-page="P.03 →">Bright floral</a>
          <a data-next="q3_night_sheen" data-param="air=night" data-page="P.03 →">Electric musk</a>
        </nav>
        <footer><a data-next="start">Restart</a></footer>
      </div>
      <figure class="art" id="art-q2_energetic"></figure>
    </div>
  </section>

  <!-- Q3 variants -->
  <section class="scene" id="q3_clean_citrus">
    <div class="visual"><div class="grain"></div><div class="scan"></div></div>
    <div class="wrap split">
      <div>
        <header><div class="cursor">Q3</div><div class="stamp" id="time-q3_clean_citrus">archive · --:--</div></header>
        <h1 class="tw" data-text="You chose clarity. Which citrus?"></h1>
        <nav class="links">
          <a data-next="q4_city" data-param="mood=clean&note=bergamot" data-page="P.04 →">Bergamot</a>
          <a data-next="q4_city" data-param="mood=clean&note=grapefruit" data-page="P.04 →">Grapefruit</a>
          <a data-next="q4_city" data-param="mood=clean&note=neroli" data-page="P.04 →">Neroli</a>
          <a data-next="q4_city" data-param="mood=clean&note=lemon" data-page="P.04 →">Lemon</a>
        </nav>
        <div class="chips"><div class="chip">fresh</div><div class="chip">airy</div><div class="chip">daylight</div></div>
        <p class="margin-note">※ Pick by vibe, not by popularity.</p>
      </div>
      <figure class="art" id="art-q3_clean_citrus"></figure>
    </div>
  </section>

  <section class="scene" id="q3_floral_soft">
    <div class="visual"><div class="grain"></div><div class="scan"></div></div>
    <div class="wrap split">
      <div>
        <header><div class="cursor">Q3</div><div class="stamp" id="time-q3_floral_soft">archive · --:--</div></header>
        <h1 class="tw" data-text="Soft bloom. Which flower?"></h1>
        <nav class="links">
          <a data-next="q4_city" data-param="mood=warm&note=rose" data-page="P.04 →">Rose</a>
          <a data-next="q4_city" data-param="mood=warm&note=jasmine" data-page="P.04 →">Jasmine</a>
          <a data-next="q4_city" data-param="mood=warm&note=peony" data-page="P.04 →">Peony</a>
          <a data-next="q4_city" data-param="mood=warm&note=iris" data-page="P.04 →">Iris</a>
        </nav>
        <div class="chips"><div class="chip">petal</div><div class="chip">musk</div><div class="chip">soft light</div></div>
      </div>
      <figure class="art" id="art-q3_floral_soft"></figure>
    </div>
  </section>

  <section class="scene" id="q3_green_breeze">
    <div class="visual"><div class="grain"></div><div class="scan"></div></div>
    <div class="wrap split">
      <div>
        <header><div class="cursor">Q3</div><div class="stamp" id="time-q3_green_breeze">archive · --:--</div></header>
        <h1 class="tw" data-text="After-rain green. Which path?"></h1>
        <nav class="links">
          <a data-next="q4_city" data-param="mood=myst&note=fig" data-page="P.04 →">Fig leaf</a>
          <a data-next="q4_city" data-param="mood=myst&note=vétiver" data-page="P.04 →">Vetiver</a>
          <a data-next="q4_city" data-param="mood=myst&note=herbs" data-page="P.04 →">Herbal</a>
          <a data-next="q4_city" data-param="mood=myst&note=tea" data-page="P.04 →">Tea</a>
        </nav>
        <div class="chips"><div class="chip">transparent woods</div><div class="chip">green</div></div>
      </div>
      <figure class="art" id="art-q3_green_breeze"></figure>
    </div>
  </section>

  <section class="scene" id="q3_night_sheen">
    <div class="visual"><div class="grain"></div><div class="scan"></div></div>
    <div class="wrap split">
      <div>
        <header><div class="cursor">Q3</div><div class="stamp" id="time-q3_night_sheen">archive · --:--</div></header>
        <h1 class="tw" data-text="Midnight sheen. What kind of allure?"></h1>
        <nav class="links">
          <a data-next="q4_city" data-param="mood=sensual&note=amber" data-page="P.04 →">Amber glow</a>
          <a data-next="q4_city" data-param="mood=sensual&note=leather" data-page="P.04 →">Leather ribbon</a>
          <a data-next="q4_city" data-param="mood=sensual&note=incense" data-page="P.04 →">Incense veil</a>
          <a data-next="q4_city" data-param="mood=sensual&note=spice" data-page="P.04 →">Saffron & spice</a>
        </nav>
        <div class="chips"><div class="chip">nocturne</div><div class="chip">silhouette</div></div>
      </div>
      <figure class="art" id="art-q3_night_sheen"></figure>
    </div>
  </section>

  <!-- Q4 → Q5 → Q6 -->
  <section class="scene" id="q4_city">
    <div class="visual"><div class="grain"></div><div class="scan"></div></div>
    <div class="wrap split">
      <div>
        <header><div class="cursor">Q4</div><div class="stamp" id="time-q4_city">archive · --:--</div></header>
        <h1 class="tw" data-text="Which city would you like to wander in now?"></h1>
        <nav class="links">
          <a data-next="q5_mat" data-param="city=paris" data-page="P.05 →">Paris</a>
          <a data-next="q5_mat" data-param="city=ny" data-page="P.05 →">New York</a>
          <a data-next="q5_mat" data-param="city=tokyo" data-page="P.05 →">Tokyo</a>
          <a data-next="q5_mat" data-param="city=maldives" data-page="P.05 →">Maldives</a>
        </nav>
        <footer><a data-next="start">Restart</a></footer>
      </div>
      <figure class="art" id="art-q4_city"></figure>
    </div>
  </section>

  <section class="scene" id="q5_mat">
    <div class="visual"><div class="grain"></div><div class="scan"></div></div>
    <div class="wrap split">
      <div>
        <header><div class="cursor">Q5</div><div class="stamp" id="time-q5_mat">archive · --:--</div></header>
        <h1 class="tw" data-text="If you were a perfume bottle, what material would you be?"></h1>
        <nav class="links">
          <a data-next="q6_echo" data-param="mat=glass" data-page="P.06 →">Transparent glass</a>
          <a data-next="q6_echo" data-param="mat=metal" data-page="P.06 →">Metal</a>
          <a data-next="q6_echo" data-param="mat=velvet" data-page="P.06 →">Velvet</a>
          <a data-next="q6_echo" data-param="mat=stone" data-page="P.06 →">Stone</a>
        </nav>
        <footer><a data-next="start">Restart</a></footer>
      </div>
      <figure class="art" id="art-q5_mat"></figure>
    </div>
  </section>

  <section class="scene" id="q6_echo">
    <div class="visual"><div class="grain"></div><div class="scan"></div></div>
    <div class="wrap split">
      <div>
        <header><div class="cursor">Q6</div><div class="stamp" id="time-q6_echo">archive · --:--</div></header>
        <h1 class="tw" data-text="What remains after the scent fades?"></h1>
        <nav class="links">
          <a data-next="result" data-param="echo=memory" data-page="P.07 →">Memory</a>
          <a data-next="result" data-param="echo=trail" data-page="P.07 →">Trail</a>
          <a data-next="result" data-param="echo=person" data-page="P.07 →">Someone</a>
          <a data-next="result" data-param="echo=air" data-page="P.07 →">Air</a>
        </nav>
        <footer><a data-next="start">Restart</a></footer>
      </div>
      <figure class="art" id="art-q6_echo"></figure>
    </div>
  </section>

  <!-- RESULT -->
  <section class="scene" id="result">
    <div class="visual"><div class="grain"></div><div class="scan"></div></div>
    <div class="wrap split">
      <div>
        <header>
          <div class="cursor">Your Scent Portrait</div>
          <div class="stamp" id="time-result">archive · --:--</div>
        </header>
        <div id="summary" class="note">Your choices assemble a profile.</div>
        <h1 id="family" class="tw" data-text=""></h1>
        <div id="picks" class="grid2"></div>
        <p id="tip" class="muted" style="display:none">Tip: Spray on your wrist and check again after 2–4 hours. Citrus/green fade faster; woods/musk last longer.</p>
        <footer><a data-next="start" data-page="P.01 ↺">Start over</a></footer>
      </div>
      <figure class="art" id="art-result"></figure>
    </div>
  </section>

  <script>
    // ===== Helpers =====
    const $$=(s,c=document)=>Array.from(c.querySelectorAll(s));
    const $=(s,c=document)=>c.querySelector(s);

    // ===== Visuals (SVG blobs) =====
    function svgBlob(label, hue){
      const bg = `hsl(${hue}, 75%, 12%)`;
      const g1 = `hsl(${(hue+30)%360}, 80%, 55%)`;
      const g2 = `hsl(${(hue+300)%360}, 70%, 45%)`;
      const txt= `hsl(${hue}, 10%, 92%)`;
      const svg = encodeURIComponent(
        `<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 600 400'>
          <defs>
            <radialGradient id='g' cx='30%' cy='30%'>
              <stop offset='0%' stop-color='${g1}' stop-opacity='0.9'/>
              <stop offset='60%' stop-color='${g2}' stop-opacity='0.35'/>
              <stop offset='100%' stop-color='${bg}' stop-opacity='0.2'/>
            </radialGradient>
          </defs>
          <rect width='600' height='400' fill='${bg}'/>
          <circle cx='180' cy='150' r='140' fill='url(#g)' />
          <circle cx='420' cy='260' r='170' fill='url(#g)' />
          <text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' fill='${txt}' font-family='Courier New, monospace' font-size='26'>${label}</text>
        </svg>`
      );
      return `url("data:image/svg+xml,${svg}")`;
    }
    function paintArt(id, label, hue){
      const el = document.getElementById('art-'+id);
      if(!el) return;
      el.style.backgroundImage=svgBlob(label,hue);
      el.style.backgroundSize='cover';
      el.style.backgroundPosition='center';
      el.style.filter='saturate(0.9)';
    }
    function perfumeThumb(name){
      const hue=Math.abs([...name].reduce((a,c)=>a+c.charCodeAt(0),0))%360;
      const label=name.split(' ')[0];
      const bg=svgBlob(label,hue);
      const code=String(name.replace(/\W/g,'').toUpperCase()).slice(0,10);
      return `<div class="thumb" style="position:relative;background-image:${bg};background-size:cover;background-position:center">
        <div style="position:absolute;left:.5rem;right:.5rem;bottom:.5rem;border:1px solid #1a1a1a;padding:.25rem .35rem;background:#0008">
          <div style="font-size:.72rem;letter-spacing:.08em">${code}</div>
          <div style="height:8px;background:repeating-linear-gradient(90deg,#fff 0 2px,transparent 2px 4px);opacity:.5;margin-top:.2rem"></div>
        </div>
      </div>`;
    }

    // ===== Data =====
    const RESULTS={
      fresh_citrus_day:{title:"Fresh Citrus / Day",picks:[
        {name:"Acqua di Parma Colonia",notes:"citrus, lavender, rosemary",vibe:"classic, bright, tailored",why:"For airy brightness with a clean finish.",link:"https://www.acquadiparma.com/"},
        {name:"Byredo Blanche",notes:"aldehydes, rose, musk",vibe:"clean, linen-fresh, minimal",why:"Soft, soapy clarity for everyday wear.",link:"https://www.byredo.com/"}
      ]},
      airy_green_woods:{title:"Airy Green Woods",picks:[
        {name:"Diptyque Philosykos (EDT)",notes:"fig leaf, coconut, woody",vibe:"sunlit, leafy, transparent",why:"Green fig with breezy woods.",link:"https://www.diptyqueparis.com/"},
        {name:"Le Labo Another 13",notes:"ambroxan, pear, musk",vibe:"sheer, modern, skin-scent",why:"Subtle radiance with a cool edge.",link:"https://www.lelabofragrances.com/"}
      ]},
      cozy_sweet_gourmand:{title:"Cozy Sweet / Gourmand",picks:[
        {name:"Replica – By the Fireplace",notes:"smoke, chestnut, vanilla",vibe:"cozy, toasted, nostalgic",why:"A smoky-sweet hug for cold evenings.",link:"https://www.maisonmargiela-fragrances.us/"},
        {name:"Prada Candy",notes:"caramel, benzoin, musk",vibe:"playful, plush, sweet",why:"Dessert-like sweetness with warmth.",link:"https://www.prada.com/"}
      ]},
      spicy_resinous_night:{title:"Spicy & Resinous / Night",picks:[
        {name:"Tom Ford Oud Wood",notes:"cardamom, oud, amber",vibe:"smoky, polished, intimate",why:"A sophisticated evening signature.",link:"https://www.tomford.com/"},
        {name:"Byredo Black Saffron",notes:"saffron, leather, raspberry",vibe:"warm, distinct, luminous",why:"Luminous spice with sleek leather.",link:"https://www.byredo.com/"}
      ]},
      floral_musk_soft:{title:"Soft Floral Musk",picks:[
        {name:"Chanel Chance Eau Tendre",notes:"grapefruit, jasmine, musk",vibe:"petal-soft, youthful, bright",why:"A dreamy everyday floral.",link:"https://www.chanel.com/"},
        {name:"Glossier You",notes:"ambrette, musk",vibe:"clean, minimalist, skin-like",why:"Barely-there, you—but better.",link:"https://www.glossier.com/"}
      ]},
      aromatic_fresh_sport:{title:"Aromatic Fresh / Sporty",picks:[
        {name:"Dior Sauvage EDT",notes:"bergamot, pepper, ambroxan",vibe:"crisp, energetic, versatile",why:"Instantly fresh, go-anywhere.",link:"https://www.dior.com/"},
        {name:"Hermès H24",notes:"clary sage, rosewood, metallic moss",vibe:"green, modern, lucid",why:"Sleek green freshness.",link:"https://www.hermes.com/"}
      ]}
    };
    const labelMaps={
      mood:{clean:"clean",warm:"warm",myst:"mysterious",sensual:"sensual"},
      air:{dawn:"morning air",noon:"afternoon light",rain:"after rain",night:"midnight calm"},
      i:{light:"light",balanced:"balanced",deep:"deep",energetic:"energetic"},
      city:{paris:"Paris",ny:"New York",tokyo:"Tokyo",maldives:"Maldives"},
      mat:{glass:"glass",metal:"metal",velvet:"velvet",stone:"stone"},
      echo:{memory:"memory",trail:"trail",person:"someone",air:"air"},
      note:{bergamot:"bergamot",grapefruit:"grapefruit",neroli:"neroli",lemon:"lemon",rose:"rose",jasmine:"jasmine",peony:"peony",iris:"iris",fig:"fig",vétiver:"vetiver",herbs:"herbal",tea:"tea",amber:"amber",leather:"leather",incense:"incense",spice:"spice"}
    };

    // ===== Routing & logic =====
    function parse(){
      const raw=location.hash.replace(/^#/,"");
      const [id='start',query='']=raw.split('?');
      const params=Object.fromEntries(new URLSearchParams(query));
      return {id,params};
    }
    function href(next, params, add){
      const q=new URLSearchParams(params);
      if(add){ for(const pair of add.split('&')){ const [k,v]=pair.split('='); if(k) q.set(k,v); } }
      const qs=q.toString();
      return `#${next}${qs?`?${qs}`:''}`;
    }
    function humanize(p){
      const order=['i','air','mood','note','city','mat','echo'];
      return order.map(k=>labelMaps[k]&&labelMaps[k][p[k]]).filter(Boolean).join(' · ');
    }
    function inferResultKey(p){
      if(p.mood==='clean'){ if(p.air==='dawn'||p.air==='rain'||p.note==='bergamot'||p.note==='neroli') return 'fresh_citrus_day'; return 'aromatic_fresh_sport'; }
      if(p.mood==='warm'){ if(p.note==='rose'||p.note==='jasmine'||p.mat==='velvet'||p.echo==='person') return 'floral_musk_soft'; return 'cozy_sweet_gourmand'; }
      if(p.mood==='sensual'){ if(p.note==='leather'||p.note==='incense'||p.note==='spice') return 'spicy_resinous_night'; return 'floral_musk_soft'; }
      if(p.mood==='myst'){ if(p.note==='fig'||p.note==='vétiver'||p.air==='rain'||p.city==='tokyo') return 'airy_green_woods'; return 'spicy_resinous_night'; }
      if(p.i==='light'&&(p.air==='dawn'||p.air==='rain')) return 'airy_green_woods';
      return 'floral_musk_soft';
    }

    // ===== Typewriter (with slight ink wobble + occasional typo) =====
    const TYPE_SPEED = 68; // ms per char base
    let soundEnabled = false;
    function tickSound(){
      if(!soundEnabled) return;
      const a = document.getElementById('click-snd');
      try{ a.currentTime = 0; a.volume = 0.12; a.play(); }catch(e){}
    }
    function typeIn(el, text){
      if(!el) return; el.classList.add('type-caret'); el.classList.remove('done');
      let i=0; el.textContent='';
      (function step(){
        if(i<=text.length){
          el.textContent = text.slice(0,i);
          // ink wobble
          el.style.textShadow = `${(Math.random()-.5)/50}px ${(Math.random()-.5)/50}px 0 #fff3`;
          // occasional typo/backspace
          if(Math.random()<0.1 && i>3 && i<text.length-2){
            el.textContent += 'x'; tickSound();
            setTimeout(()=>{ el.textContent = el.textContent.slice(0,-1); }, TYPE_SPEED*1.6);
          }
          tickSound();
          i++; setTimeout(step, TYPE_SPEED + Math.random()*28);
        } else {
          el.classList.remove('type-caret'); el.classList.add('done');
          el.style.textShadow = 'none';
        }
      })();
    }
    function typeScene(scene){ scene && scene.querySelectorAll('.tw').forEach(el=> typeIn(el, el.dataset.text || el.textContent || '')); }
    function prepareTypeTargets(){ $$('.tw').forEach(el=>{ if(!el.dataset.text){ el.dataset.text=(el.textContent||'').trim(); } el.textContent=''; }); }

    // ===== Time stamps =====
    function stampNow(id){ const s=new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}); const el=$(`#time-${id}`); if(el) el.textContent=`archive · ${s}`; }

    // ===== Render =====
    function render(){
      const {id,params}=parse();
      $$('.scene').forEach(s=>s.classList.remove('active','cut-in'));
      const scene=document.getElementById(id)||document.getElementById('start');
      scene.classList.add('active');
      void scene.offsetWidth; scene.classList.add('cut-in'); // cut flash

      // ensure links have hrefs merged with params
      $$('a[data-next]').forEach(a=>{ a.setAttribute('href', href(a.dataset.next||'', params, a.dataset.param||'')); a.style.cursor='pointer'; });

      // paint art based on most recent param
      const keys=['note','mood','air','i']; let hue=210; let label='Scent';
      for(const k of keys){ if(params[k]){ const seed=Math.abs([...params[k]].reduce((a,c)=>a+c.charCodeAt(0),0)); hue=seed%360; label=(labelMaps[k]&&labelMaps[k][params[k]])||label; break; } }
      paintArt(id,label,hue);

      // stamps
      stampNow(id);

      // result composition
      if(id==='result'){
        $('#summary').textContent = humanize(params) ? `You lean toward: ${humanize(params)}` : 'Your choices assemble a profile.';
        const key=inferResultKey(params); const data=RESULTS[key];
        const fam=$('#family'); fam.dataset.text = `Suggested Family — ${data.title}`; fam.textContent='';
        $('#picks').innerHTML = data.picks.map(p=>`
          <a class="note" style="display:block;color:inherit" href="${p.link}" target="_blank" rel="noreferrer">
            ${perfumeThumb(p.name)}
            <div style="margin-top:.5rem"><strong>${p.name}</strong></div>
            <div class="muted">Notes: ${p.notes}</div>
            <div class="muted">Vibe: ${p.vibe}</div>
            <div>${p.why}</div>
          </a>`).join('');
        paintArt('result', data.title, Math.abs(key.split('').reduce((a,c)=>a+c.charCodeAt(0),0))%360);
        $('#tip').style.display='block';
      }

      // typewriter after all content set
      typeScene(scene);
    }

    // ===== Init =====
    window.addEventListener('hashchange', render);
    window.addEventListener('click', ()=>{ soundEnabled=true; }, {once:true});
    window.addEventListener('DOMContentLoaded', ()=>{
      // basic fallbacks so links work pre-render
      $$('a[data-next]').forEach(a=>{ if(!a.getAttribute('href')) a.setAttribute('href','#'+(a.dataset.next||'')); });
      prepareTypeTargets();
      if(!location.hash) location.hash='#start';
      try{ render(); }
      catch(e){ console.error('[initial render failed]', e); $$('.tw').forEach(el=> el.textContent = el.dataset.text || el.textContent || ''); }
    });
  </script>
</body>
</html>
